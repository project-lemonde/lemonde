# 開発ガイド (DEVELOPMENT.md)

## 1. 概要
このドキュメントは、Project LeMonde に貢献する開発者および **AI エージェント**に必要な技術知識、周辺技術、および開発プラクティスを概説します。
**Project LeMonde は、少人数（多くの場合一人）での開発が想定されるため、開発プロセス全体を通じて AI エージェントによる積極的かつ高度なサポートを前提としています。AI エージェントは、単なるツールとしてではなく、開発チームの一員として機能し、設計、実装、テスト、デバッグの各フェーズで開発者を支援します。**

## 2. コア技術スタック
このプロジェクトでは、主に以下の技術を利用します。

- **プログラミング言語:** TypeScript
- **フロントエンドフレームワーク:** React
- **3Dレンダリングエンジン:** Babylon.js
- **リアルタイムコミュニケーション:** WebRTC (P2Pデータ、音声、ビデオ用)
- **共同編集:** CRDT (例: Yjs) (コンフリクトフリーなデータ同期用)
- **パッケージ管理:** pnpm (モノレポおよび依存関係管理用)
- **ビルドツール / 開発サーバー:** Vite
- **バージョン管理:** Git / GitHub

## 3. 必要な技術知識
開発者および AI エージェントは、以下の分野の知識を習得または保有している必要があります。

- **TypeScript & モダンJavaScript (ES6+):** 型、async/await、モジュールなどに関する深い理解。
- **React:** コンポーネントベースのアーキテクチャ、フック、状態管理、コンテキストAPI。
- **Babylon.js:** シーングラフ、メッシュ、マテリアル、ライト、カメラ、アニメーション、およびパフォーマンス最適化。3D数学（ベクトル、行列、クォータニオン）の理解が非常に役立ちます。
- **WebRTC:** P2P接続、データチャネル、STUN/TURNサーバー、シグナリングメカニズム。
- **CRDT (Yjs または類似のもの):** リアルタイム共同編集アプリケーションを構築するためのCRDTの原則の理解。共有データ型を構造化および管理する方法。
- **Node.js:** バックエンドサービス、ツール、またはシグナリングサーバーの実装の可能性。
- **フロントエンドビルドツール (Vite):** 設定、プラグイン、および最適化。
- **バージョン管理 (Git):** ブランチ、マージ、プルリクエスト、および共同ワークフロー。
- **ネットワークプロトコル:** TCP/IP、UDP、HTTP/HTTPSの基礎。
- **ソフトウェアデザインパターン:** 保守可能でスケーラブルなコードを作成するため。
- **テスト:** ユニットテスト (例: Vitest, Jest)、インテグレーションテスト、およびエンドツーエンドテスト (例: Playwright, Cypress)。
- **セキュリティベストプラクティス:** 特にP2P環境、データ検証、および一般的なWeb脆弱性（XSS、CSRF）の防止。
**- AIとの連携:** 開発プロセスにおいてAIエージェントと効果的に協調するためのプロンプトエンジニアリングや、AIの提案を評価・統合する能力。**

## 4. 周辺技術とコンセプト
これらの技術に精通していることは、現在または将来の開発に役立ちます。

- **WebAssembly (Wasm):** パフォーマンスが重要なモジュール用 (例: 物理演算、複雑な計算)。
- **WebSockets:** シグナリングまたは特定の種類のクライアントサーバー通信のためのWebRTCの代替または補足として。
- **WebXR:** 将来のAR/VR統合用。
- **AI/MLライブラリ (例: TensorFlow.js, ONNX.js):** AI支援によるコンテンツ作成、NPCの行動、またはモデレーションの実装用。
- **分散ストレージ (例: IPFS):** ユーザー生成コンテンツを分散型で保存するため。
- **IDおよび認証システム:** 分散型識別子（DID）、自己主権型アイデンティティ（SSI）の概念（ユーザー証明書用）。
- **ブロックチェーン/DLT:** 仮想通貨またはNFTのような資産所有権との潜在的な統合用（MVPの主要な焦点ではありません）。
- **コンテナ化 (Docker):** 開発および展開環境の標準化用。
- **CI/CD (例: GitHub Actions):** テストおよび展開パイプラインの自動化用。

## 5. 開発プラクティス
- **モノレポ構造:** pnpmワークスペースを利用した複数パッケージの管理 (例: `apps/`, `packages/`)。
- **コードスタイルとリンティング:** ESLint、Prettier、Biomeなどのツールを使用した強制。
- **アジャイル方法論:** 反復開発、定期的なスプリント、およびフィードバックループ。
- **コードレビュー:** すべてのコード変更はマージ前にレビューされる必要があります。
- **包括的なドキュメンテーション:** コード、API、およびアーキテクチャ上の決定の文書化。
- **テスト駆動開発 (TDD) / ビヘイビア駆動開発 (BDD):** 該当する場合に推奨。

## 6. AIエージェント向け情報
開発またはサポートに関与するAIエージェントは、以下を実行できる必要があります。

- **コア技術スタックの深い理解:** 互換性のある効率的なコードを生成し、複雑な技術的課題に対する解決策を提案するため。
- **開発プラクティスの遵守と推進:** コードスタイル、テスト戦略、ドキュメンテーション標準を理解し、これらを遵守した成果物を生成する。開発者に対してベストプラクティスを推奨することも期待される。
- **PRDおよび技術仕様の能動的解釈:** 要件を深く理解し、潜在的な問題点や改善点を指摘し、それに応じて機能を能動的に提案・実装するため。
- **モノレポ構造での自律的作業:** プロジェクト全体の構造を理解し、関連するパッケージやモジュールを横断して、自律的にコードの変更や追加を行う。
- **提供されたAPIの高度な利用と拡張提案:** システムのさまざまな部分（例: 3Dシーン、共同編集状態、他のAIサービス）と効果的に対話し、必要に応じてAPIの改善や拡張を提案する。
- **高度なデバッグと問題解決支援:** コードを静的・動的に分析し、根本原因を特定し、具体的な修正案や代替アプローチを複数提示する。**特にマルチプレイ環境における複雑な同期問題や競合状態のデバッグを支援する。**
- **ドキュメンテーションの自動生成と維持管理への貢献:** コードコメントからのドキュメント生成、仕様変更に伴う既存ドキュメントの更新、不足しているドキュメントの指摘と草案作成。
- **コラボレーションのためのデータ構造の深い理解と最適化提案:** Yjsまたは他のCRDTが共有状態（例: 3Dオブジェクトの位置、プロパティ、シーン階層）をどのように表現および同期するかを理解し、パフォーマンスやスケーラビリティの観点から最適化案を提案する。
- **自律的な空間作成/サポートのためのインターフェースとプロアクティブな提案:**
    - **入力:** ユーザープロンプト、既存のシーンデータ、事前定義されたテンプレート、コンテキスト情報、**開発中のブランチのコード全体、関連するIssueやPRの議論内容。**
    - **出力:** CRDT共有状態への変更（新しいオブジェクト、変換されたオブジェクト）、ユーザーへの提案、手続き型生成パラメータ、**具体的なコード変更の提案（diff形式など）、テストケースの自動生成。**
    - **機能:** オブジェクトの配置、マテリアルの適用、環境生成、NPCのパスファインディング（将来）、インタラクティブなチュートリアル、**開発者の意図を汲み取ったプロアクティブなコーディング支援、リファクタリング提案。**
- **ランタイムデバッグへのNPCとしての参加:**
    - **役割:** マルチプレイ開発時、特に開発者が一人の場合に、他のプレイヤーとしてセッションに参加し、テストを支援する。
    - **機能:**
        - **基本的なインタラクション:** 移動、オブジェクト操作、チャットなど、人間のプレイヤーが実行可能な基本的なアクションを模倣する。
        - **シナリオ実行:** 事前に定義されたテストシナリオ（例: 特定のアイテムを特定の手順で使用する、特定の場所に移動する）を正確に実行する。
        - **ストレステスト:** 多数のNPCを同時接続させ、システムの負荷耐性をテストする。
        - **エッジケースの再現:** 特定の条件下でのみ発生するバグの再現を試みる。
        - **状態報告:** 実行中のNPCの内部状態や観測された問題を開発者にリアルタイムで報告する。
    - **協調:** 開発者の指示に応じて動的に行動を変更したり、特定のデバッグタスクに協力したりする。

このドキュメントは、プロジェクトの進化に合わせて更新されます。
